import oracledb from 'oracledb';
import { dbConfig } from './dbConfig.js';
//import { platform } from 'os';
oracledb.outFormat = oracledb.OUT_FORMAT_OBJECT;

export async function connection() {
    // let db="";
    try{
        var db = null;
        db = await oracledb.getConnection(dbConfig);
        console.log(((db)?"Database connected!":"Database not connected!"));
        return db;
    }
    catch (e) {
    console.log("ERROR CONNECTING DB: "+e.message);
    throw e;
    // return;
    }
}
/*
async function createTable() {
    let db;
    try{
        db = await connection();
        const sql = `CREATE TABLE TaskList (
            uid NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
            platform VARCHAR2(15),
            taskURL VARCHAR2(100) NOT NULL,
            taskName VARCHAR2(50) NOT NULL,
            status VARCHAR2(50) DEFAULT 'Pending',
            Note VARCHAR2(300)
        );
        `;
        await db.execute(sql);
        console.log("Table created successfully");
    }
    catch(err){
        console.log("Error creating table, err: "+err.message);
    }
    finally{
        if(db){
            try{await db.close();}
            catch(e){console.error("Error closing db on Create Table: "+e.message);}
        }
    }

}*/
// Call closePool() when done with application
export async function closePool() {
    try {
        await oracledb.getPool().close();
        console.log("Connection pool closed.");
    } catch (err) {
        console.error("Error closing connection pool:", err);
    }
}
// const cmd_trigger = `CREATE TRIGGER IF NOT EXISTS set_course_id 
//     BEFORE INSERT ON courses
//     BEGIN
//         UPDATE courses
//         SET courseId = NEW.courseId || NEW.uid
//         WHERE rowid = NEW.rowid;
//     END;`;

// createTable();